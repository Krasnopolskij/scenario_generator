<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Граф — Scenario Generator</title>
  <link rel="stylesheet" href="/static/css/style.css?v=20251027-2" />

</head>
<body class="page-graph">
  <header>
    <h1>Визуализация связей CPE</h1>
    <nav class="nav">
      <button id="open-theme" type="button" class="btn-secondary" title="Настройки отображения" aria-label="Настройки">⚙</button>
      <a href="/" class="nav-link">Сбор данных</a>
      <a href="/cpe" class="nav-link">Выбор CPE</a>
      <a href="/graph" class="nav-link active">Визуализация</a>
    </nav>
  </header>

  <main>
    <section class="controls">
      <h2>Построение связей CPE</h2>
      <form id="graph-form" class="form-inline">
        <label for="cpe">URI объекта защиты:</label>
        <input id="cpe" name="cpe" type="text" placeholder="например, cpe:2.3:a:linkace:linkace:*:*:*:*:*:*:*:*" />
        <select id="mode" name="mode">
          <option value="full" selected>Полный (CVE→CWE→CAPEC→Technique)</option>
          <option value="simple">Только CVE→CPE</option>
        </select>
        <div class="actions">
          <button id="draw-btn" type="submit">Построить</button>
          <button id="clear-graph" type="button" title="Очистить граф и форму">Очистить</button>
        </div>
      </form>
      <p class="hint"></p>

      <h2>Генерация сценариев</h2>
      <div class="scenarios-ctrl">
        <div class="field">
          <label for="sc-mode">Режим генерации:</label>
          <select id="sc-mode">
            <option value="strict" selected>Строгий</option>
            <option value="relaxed">Нестрогий</option>
          </select>
        </div>
        <div class="field">
          <label for="view-mode">Режим отображения:</label>
          <select id="view-mode">
            <option value="linear" selected>Линейные сценарии</option>
            <option value="primary">Первичный сценарий</option>
          </select>
        </div>
        <div class="field">
          <label for="show-all-cves">
            <input type="checkbox" id="show-all-cves" /> Отобразить все связанные CVE
          </label>
        </div>
        <div class="field">
          <label for="sc-max-per-tactic">Максимум техник на тактику:</label>
          <div class="input-wrap">
            <input id="sc-max-per-tactic" type="number" min="1" max="10" step="1" value="2" />
          </div>
        </div>
        <div class="actions sc-actions">
          <button id="gen-scenarios" type="button">Сгенерировать сценарии</button>
          <button id="clear-scenarios" type="button" title="Очистить список и подсветку">Очистить</button>
        </div>
        <div id="scenarios-list" class="scenarios"></div>
      </div>
    </section>

    <section>
      <div id="graph"></div>
    </section>

    <aside class="inspector">
      <button id="insp-toggle" class="insp-toggle" type="button" title="Свернуть/развернуть панель" aria-label="Свернуть панель"></button>
      <h2>Свойства узла</h2>
      <div id="inspector-content" class="kv">
        <div class="row"><div class="k">Подсказка</div><div class="v">Кликните по узлу на графе</div></div>
      </div>
    </aside>
  </main>

  <!-- Модальное окно настроек визуализации -->
  <div id="theme-backdrop" class="modal-backdrop" hidden>
    <div class="modal">
      <div class="modal-title">Настройки визуализации</div>
      <div class="modal-body">
        <div class="theme-row">
          <label>Цвет фона холста</label>
          <input id="theme-canvas" type="color" value="#0f1326" />
        </div>
        <div class="theme-row">
          <label>Цвет надписей (label)</label>
          <input id="theme-label" type="color" value="#e5e7ef" />
        </div>
        <hr style="border:0;border-top:1px solid #1d2342;margin:10px 0">
        <div class="theme-row">
          <label>Цвет узлов CPE</label>
          <input id="theme-node-cpe" type="color" value="#8e44ad" />
        </div>
        <div class="theme-row">
          <label>Цвет узлов CVE</label>
          <input id="theme-node-cve" type="color" value="#e74c3c" />
        </div>
        <div class="theme-row">
          <label>Цвет узлов CWE</label>
          <input id="theme-node-cwe" type="color" value="#e49659" />
        </div>
        <div class="theme-row">
          <label>Цвет узлов CAPEC</label>
          <input id="theme-node-capec" type="color" value="#3498db" />
        </div>
        <div class="theme-row">
          <label>Цвет узлов Technique</label>
          <input id="theme-node-tech" type="color" value="#4fca21" />
        </div>
        <hr style="border:0;border-top:1px solid #1d2342;margin:10px 0">
        <div class="theme-row">
          <label>Связь AFFECTS</label>
          <input id="theme-edge-AFFECTS" type="color" value="#c0392b" />
        </div>
        <div class="theme-row">
          <label>Связь CWE_TO_CVE</label>
          <input id="theme-edge-CWE_TO_CVE" type="color" value="#d35400" />
        </div>
        <div class="theme-row">
          <label>Связь CAPEC_TO_CWE</label>
          <input id="theme-edge-CAPEC_TO_CWE" type="color" value="#2980b9" />
        </div>
        <div class="theme-row">
          <label>Связь CAPEC_PARENT_TO_CAPEC_CHILD</label>
          <input id="theme-edge-CAPEC_PARENT_TO_CAPEC_CHILD" type="color" value="#7f8c8d" />
        </div>
        <div class="theme-row">
          <label>Связь CAPEC_TO_TECHNIQUE</label>
          <input id="theme-edge-CAPEC_TO_TECHNIQUE" type="color" value="#27ae60" />
        </div>
        <div class="theme-row">
          <label>Связь SC_STEP</label>
          <input id="theme-edge-SC_STEP" type="color" value="#7f8c8d" />
        </div>
        <div class="theme-row">
          <label>Связь SC_TECH_TO_CVE</label>
          <input id="theme-edge-SC_TECH_TO_CVE" type="color" value="#8e44ad" />
        </div>
        <div class="theme-row">
          <label>Связь SC_GROUP</label>
          <input id="theme-edge-SC_GROUP" type="color" value="#7f8c8d" />
        </div>
      </div>
      <div class="modal-actions">
        <button id="theme-reset" class="btn-secondary" title="Сбросить к стандартным цветам">Сбросить</button>
        <span style="flex:1"></span>
        <button id="theme-cancel" class="btn-secondary">Отмена</button>
        <button id="theme-apply" class="btn-primary">Применить</button>
      </div>
    </div>
  </div>

  <footer>
    <span></span>
  </footer>

  <!-- Локальная библиотека Cytoscape -->
  <script src="/static/js/vendor/cytoscape.js-3.33.1/dist/cytoscape.min.js"></script>
  <script src="/static/js/graph.js?v=20251027-7"></script>
</body>
</html>
